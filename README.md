# locdp/cli

## Install

- Require: Node >=10

### Install global

```bash
npm install -g @locdp/cli
```

### Commands

```bash
# Displaying all commands
ld

# Commit format
ld commit

# Auto generate changelogs
ld changelogs
```

### Commands for changelogs CLI

```bash
# Record changelogs for the new version since the latest tag
ld changelogs
```

#### Options

- `--all`: Record all changelogs.
- `--from`, `--to`: Record logs from `from` to `to`, where `from` and `to` can be tags or commit hashes. If only `from` is provided, `to` defaults to the HEAD commit.
  - `ld-changelogs --from=v1.0.0 --to=v1.0.1`
  - `ld-changelogs --from=e4c226b --to=786a238`
  - `ld-changelogs --from=v1.0.0`
- `-v, --version`: Default to `package.json` version. If specified, record changelogs for this version.
  - `ld-changelogs --version=v1.0.1`
- `-o, --output`: Record changelogs in a different file than `CHANGELOG.md`.
  - `ld-changelogs --output=CHANGELOG-1.0.1.md`

## Build

```bash
npm run build
```

## Install packages

### [husky](https://typicode.github.io/husky/)

```bash
# install
npm install --save-dev husky
```

### [lint-staged](https://github.com/lint-staged/lint-staged)

```bash
npm install --save-dev lint-staged
```

### [commitlint](https://commitlint.js.org/)

```bash
npm install --save-dev @commitlint/config-conventional @commitlint/cli
```

### [cz-git](https://cz-git.qbb.sh/)

```bash
# global installation commitizen, that you can quickly use the cz or git cz command to start.
npm install -g commitizen
```

### Install dependencies

```bash
npm install -D cz-git
```

## Config

### Step 1: Init husky

```bash
npx husky init
```

### Step 2: Create `.husky/pre-commit` file

```bash
npm run lint:lint-staged

npm run typecheck
```

### Step 3: Create `.husky/commit-msg` file

```bash
npx --no -- commitlint --edit \
```

### Step 4: Create `.husky/lintstagedrc.mjs` file

```javascript
export default {
  "*.{js,jsx,ts,tsx}": ["eslint --fix", "prettier --write"],
  "!(package)*.json": ["prettier --write--parser json"],
  "package.json": ["prettier --write"],
  "*.vue": ["eslint --fix", "prettier --write"],
  "*.{vue,css,scss,postcss,less}": ["prettier --write"],
  "*.md": ["prettier --write"],
};
```

### Step 5: Create `commitlint.config.ts` file

<details>
  <summary>Show code</summary>

```typescript
import type { UserConfig } from "@commitlint/types";
import { RuleConfigSeverity } from "@commitlint/types";

const configuration: UserConfig = {
  ignores: [
    (commit) => commit.includes("init") || /^dev\d+\.\d+\.\d+/.test(commit),
  ],
  extends: ["@commitlint/config-conventional"],
  rules: {
    // https://commitlint.js.org/#/reference-rules
    "body-leading-blank": [RuleConfigSeverity.Error, "always"],
    "footer-leading-blank": [RuleConfigSeverity.Warning, "always"],
    "header-max-length": [RuleConfigSeverity.Error, "always", 108],
    "subject-empty": [RuleConfigSeverity.Error, "never"],
    "type-empty": [RuleConfigSeverity.Error, "never"],
    "type-case": [RuleConfigSeverity.Error, "always", "sentence-case"],
    "type-enum": [
      RuleConfigSeverity.Error,
      "always",
      ["Add", "Fix", "Update", "Build", "Docs", "Optz", "Chore", "Test"],
    ],
  },
};

export default configuration;
// <type>(<scope>): <subject> (#issue)

// type-case: [
//   'lower-case', // default
//   'upper-case', // UPPERCASE
//   'camel-case', // camelCase
//   'kebab-case', // kebab-case
//   'pascal-case', // PascalCase
//   'sentence-case', // Sentence case
//   'snake-case', // snake_case
//   'start-case', // Start Case
// ];
```

</details>

### Step 6: Create [`config/cz.config.mjs`](https://cz-git.qbb.sh/config/) file

<details>
  <summary>Show code</summary>

```javascript
/** @type {import('cz-git').CommitizenGitOptions} */
export default {
  skipQuestions: ["body", "breaking"],
  messages: {
    type: "Select the TYPE of commit:",
    scope: "SCOPE (optional):",
    customScope: "Enter SCOPE:",
    subject: "MESSAGE - Write a short description of the change:\n",
    body: 'BODY - Provide a longer description of the change (optional). Use "|" to break new line:\n',
    breaking: 'List any BREAKING CHANGES (optional). Use "|" to break new line:\n',
    footerPrefixesSelect: "Select the type of ISSUES changeList by this change (optional):",
    customFooterPrefix: "Prefix ISSUES: ",
    footer: "List ISSUES. E.g., #31, #34: ",
    generatingByAI: "Generating your AI commit subject...",
    generatedSelectByAI: "Select suitable subject generated by AI:",
    confirmCommit: "Are you sure you want to proceed with the above commit?",
  },
  types: [
    {
      value: "Add",
      name: "Add:       Add a new feature",
    },
    {
      value: "Update",
      name: "Update:    Modify code without adding a new feature",
    },
    {
      value: "Fix",
      name: "Fix:       Fix a bug",
    },
    {
      value: "Build",
      name: "Build:     Changes related to the build process",
    },
    {
      value: "Docs",
      name: "Docs:      Documentation changes only",
    },
    {
      value: "Optz",
      name: "Optz:      Performance improvements",
    },
    {
      value: "Chore",
      name: "Chore:     Other changes that do not affect src or test files",
    },
    {
      value: "Test",
      name: "Test:      Add missing test cases or update existing ones",
    },
  ],
  issuePrefixes: [
    {
      value: "link",
      name: "link:     Link to ISSUES",
    },
  ],
};
```

</details>

### Step 7: Modify `package.json` to add `config` Specify the adapter use

```json
{
  "scripts": {
    "typecheck": "vue-tsc --build --force",
    "lint:lint-staged": "lint-staged -c ./.husky/lintstagedrc.mjs"
  },
  "config": {
    "commitizen": {
      "path": "node_modules/cz-git",
      "czConfig": "./cz.config.mjs"
    }
  }
}
```
